CREATE TABLE ATHENS15.STUDENTS_ATTEND AS 
SELECT 
	* 
FROM ATHENS15.VIS_ACTSTUD_ATTEND
UNION ALL 
SELECT 
	*
FROM ATHENS15.VIS_FORMSTUD_ATTEND;
     
CREATE TABLE PROJEKT.STUDENTS_BY_MODULE AS
SELECT
	D.DEGREE_NAME,
    B.NODE_TITLE,
    C.SEMESTER_VALUE,
    COUNT(A.ST_STUDIES_NR)
FROM PROJEKT.STUDENTS_ATTEND AS A
LEFT JOIN (select NODE_TITLE, node_id, CURRICULUM_NR 
from ATHENS15.VIS_MODULE_NODE) AS B
	ON (A.NODE_ID = B.NODE_ID and A.CURRICULUM_NR = B.CURRICULUM_NR)
LEFT JOIN (SELECT NODE_ID, ST_STUDIES_NR, SEMESTER_VALUE 
FROM ATHENS15.VIS_NODE_SEMESTER) AS C
	ON (A.NODE_ID = C.NODE_ID AND A.ST_STUDIES_NR = C.ST_STUDIES_NR) 
LEFT JOIN (SELECT CURRICULUM_NR, DEGREE_NAME 
FROM ATHENS15.VIS_CURRICULUM_VERSION) AS D
	ON A.CURRICULUM_NR = D.CURRICULUM_NR
WHERE NODE_TITLE != '' AND SEMESTER_VALUE IS NOT NULL 
GROUP BY D.DEGREE_NAME, B.NODE_TITLE, C.SEMESTER_VALUE;